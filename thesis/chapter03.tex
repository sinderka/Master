%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Time integration methods} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%!!!!!!!!!!!!!!!!Burde det vært restart her også?!!!!!!!!!!!!!!!\\
This section will be concerned with comparing some different methods for integration in time. How well they estimate the error and energy will be the primary concern.\\

The relevant integration methods are trapezoidal rule, forward euler, and midpoint rule. The definition and the iteration scheme of the different methods are given in table \ref{tab:intmet}. 

\begin{table}
\begin{tabular}{l l}
	Trapezoidal rule \cite{trapezoidal} & $U_{i+1} = U_{i}+h_t g \Big( \frac{1}{2}(t_i+t_{i+1}),\frac{1}{2}(U_i+U_{i+1}) \Big)$
	\\ & $U_{i+1} = (I- \frac{A h_t}{2}) ^{-1} \Big(  U_i + \frac{h_t}{2} \big( A U_i+(F_{i+1}+F_i) \big)  \Big) $\\
\hline	
	Forward Euler \cite{forwardeuler} & $ U_{i+1} = U_i + h_t g ( t_i, U_i ) $ \\ & $ U_{i+1} = U_i + h_t \big( A U_i + F_i \big) $ \\
	\hline
	Midpoint rule \cite{midpoint} & $U_{i+1} = U_i + h_t + g \Big(  t_{i+\frac{1}{2}} , \frac{1}{2}(U_i + U_{i+1})    \Big) $ \\ & 
	$U_{i+\frac{1}{2}} = U_i + \frac{h_t}{2} ( A U_i + F_i )$ \\ &
    $U_{i+1} = (I-\frac{A h_t}{2}) ^{-1} (U_{i+\frac{1}{2}} + \frac{h_t}{2} F_{i+ \frac{1}{2}})$
\end{tabular}

\caption{Methods for integrating in time. Note that since the midpoint rule uses $F_{i+\frac{1}{2}}$ we need to save twice as many points for midpoint rule, as for the other methods.} 
\label{tab:intmet}
\end{table}


\subsection{Constant energy}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconvtrap.jpg}
                \caption{ Help line decreases with $k^2$. }
                \label{fig:intconvtrap}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconveul.jpg}
                \caption{ Help line decreases with $k$. }
                \label{fig:intconveul}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconvmid.jpg}
                \caption{ Help line decreases with $k^2$. }
                \label{fig:intconvmid}
        \end{subfigure}
        
        
\caption{Figure of the convergence for the different integration methods. All methods converge with the expected rate.}
\label{fig:intconv}
\end{figure}

\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energyovertimetrapezoidal.jpg}
                \caption{ Energy with trapezoidal rule. }
                \label{fig:energyovertimetrapezoidal}
        \end{subfigure}%
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energyovertimeeuler.jpg}
                \caption{ Energy with forward Euler }
                \label{fig:energyovertimeeuler}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energyovertimemidpoint.jpg}
                \caption{ Energy with midpoint rule }
                \label{fig:energyovertimemidpoint}
        \end{subfigure}
        
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorovertimetrapezoidal.jpg}
                \caption{ Error with trapezoidal rule }
                \label{fig:errorovertimetrapezoidal}
        \end{subfigure}%
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorovertimeeuler.jpg}
                \caption{ Error with forward Euler }
                \label{fig:errorovertimeeuler}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorovertimemidpoint.jpg}
                \caption{ Error with midpoint rule }
                \label{fig:errorovertimemidpoint}
        \end{subfigure}
        \caption{A snapshot of how energy and error changes over the simulated time with the different integration method without restart.}
        \label{fig:error}
\end{figure}
Both trapezoidal rule and midpoint rule to gives a very precise estimation of energy and error. Forward Euler on the other hand gives a linearly increasing energy, and with that a larger error, making it useless as an integration method in this case. The reason for the wired shapes in figure \ref{fig:errorovertimetrapezoidal} and \ref{fig:errorovertimemidpoint} is the periodicity of the test problem. 
\subsection{Varying energy}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconvtrap2.jpg}
                %\includegraphics[width=\textwidth]{test}
                \caption{ Help line decreases with $k^2$. }
                \label{fig:intconvtrap2}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconveul2.jpg}
                %\includegraphics[width=\textwidth]{test}
                \caption{ Help line decreases with $k$. }
                \label{fig:intconveul2}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/intconvmid2.jpg}
                %\includegraphics[width=\textwidth]{test}
                \caption{ Help line decreases with $k^2$. }
                \label{fig:intconvmid2}
        \end{subfigure}
\caption{Figure of the convergence for the different integration methods. All methods converge with the expected rate.}
\label{fig:intconv2}
\end{figure}
\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energychangtimetrapezoidal.jpg}
                \caption{ Energy with trapezoidal rule. }
                \label{fig:energychangtimetrapezoidal}
        \end{subfigure}%
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energychangtimeeuler.jpg}
                \caption{ Energy with forward Euler. }
                \label{fig:energychangtimeeuler}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/energychangtimemidpoint.jpg}
                \caption{ Energy with midpoint rule. }
                \label{fig:energychangtimemidpoint}
        \end{subfigure}
        
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorchangtimetrapezoidal.jpg}
                \caption{ Error with trapezoidal rule. }
                \label{fig:errorchangtimetrapezoidal}
        \end{subfigure}%
        ~
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorchangtimeeuler.jpg}
                \caption{ Error with forward Euler. }
                \label{fig:errorchangtimeeuler}
        \end{subfigure}
        \begin{subfigure}[b]{0.30\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/errorchangtimemidpoint.jpg}
                \caption{ Error with midpoint rule rule. }
                \label{fig:errorchangtimemidpoint}
        \end{subfigure}
        \caption{A snapshot of how energy and error changes over the simulated time with the different integration method without restart.\\$\neptune$}
        \label{fig:errorchang}
\end{figure}
In this case all methods gives a suitable convergence for the error and the energy. There is no longer any problems with forward Euler's increasing energy. Again the shapes on the figures is a property of the test problems, and not a flaw in the method.

\section{Energy preservation for SLM }%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
It can be proved that a restart of SLM does not alter the energy \cite{luli}. This section is devoted to seeing holds with numerical approximations. \\



\subsection{Constant energy} \label{sec:SLMconstant}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!!!!!!!!!!!!!!!!!!!!!Det må skrives en del mer i dette kapitelet!!!!!!!!!!!!!!!!!!!!!!\\

\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareEnergy.jpg}
                \caption{Energy.}
                \label{fig:compareEnergy}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareError.jpg}
                \caption{ Error. }
                \label{fig:compareError}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareIter.jpg}
                \caption{ Number of restarts.  }
                \label{fig:compareIter}
        \end{subfigure}
        \caption{ The figure shows how the different methods change the energy and error with different number of restart for \texttt{semirandom}.  }
        \label{fig:compare}
\end{figure}


\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareEnergyw.jpg}
                \caption{ Energy. }
                \label{fig:compareEnergyw}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareErrorw.jpg}
                \caption{ Error. }
                \label{fig:compareErrorw}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareIterw.jpg}
                \caption{ Number of restarts.  }
                \label{fig:compareIterw}
        \end{subfigure}
        \caption{ The figure shows how the different methods change the energy and error with different number of restart for \texttt{wave}.  }
        \label{fig:comparew}
\end{figure}

There is a clear difference between how well the energy is estimated for \texttt{wave} and \texttt{semirandom}. For \texttt{semirandom} there is not much difference between SLM and Arnoldi, although SLM seams to give a slight better approximation than Arnoldi. With \texttt{semirandom} at $\epsilon = 10^{-10}$ Arnoldi preforms one more iteration than SLM, which makes it give a better approximation, aside from that SLM consistently preform better than Arnoldi.\\
When comparing figure \ref{fig:compare} and figure \ref{fig:comparew} it is important to remember that the way the $er_1$ and $er_2$ is found is very differently, and that might explain the why the cases differs so much. But the difference might also be explained with \texttt{semiradom} being a much harder equation to solve.\\
!!!!!!!!!!!!!Skriv litt mer om hvorfor bildene for semirandom og wave er så forksjelkige!!!!!!!!!!!!!!!!!!!!!\\

\subsection{Varying energy}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareEnergy2.jpg}
                \caption{ The difference in energy with and without restart. }
                \label{fig:compareEnergy2}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareError2.jpg}
                \caption{ The difference in energy with and without restart. }
                \label{fig:compareError2}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareIter2.jpg}
                \caption{ The number of iterations performed with and without restarting.  }
                \label{fig:compareIter2}
        \end{subfigure}
        \caption{ The figure shows how the different methods change the energy and error with different number of restart for \texttt{wave}.  }
        \label{fig:compare2}
\end{figure}


\begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareEnergy2w.jpg}
                \caption{ The difference in energy with and without restart. }
                \label{fig:compareEnergy2w}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareError2w.jpg}
                \caption{ The difference in energy with and without restart. }
                \label{fig:compareError2w}
        \end{subfigure}
        ~
        \begin{subfigure}[b]{0.3\textwidth}
                \includegraphics[width=\textwidth]{../MATLAB/fig/compareIter2w.jpg}
                \caption{ The number of iterations performed with and without restarting.  }
                \label{fig:compareIter2w}
        \end{subfigure}
        \caption{ The figure shows how the different methods change the energy and error with different number of restart for \texttt{wave}.  }
        \label{fig:compare2w}
\end{figure}
The results here are very similar to the results found in section \ref{sec:SLMconstant}, except that the energy and error changes for the first points for both SLM and Arnoldi. SLM still gives the better approximation.